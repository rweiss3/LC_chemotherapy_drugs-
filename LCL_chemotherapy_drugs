#have p-value for ARCA, CIS, and CARBO 
#LC Chemotherapy Drugs 
	#FID
	#IID- Independent and identically distributed random variables
#Data availble in /home/wheelerlab3/Data/LCL_chemotherapy/
  cd /home/wheelerlab3/Data/LCL_chemotherapy/
  less LCL_drug_assay_info.txt
   Drug            populations                             uM_concentrations               best_phenotype  hrs_drug_treatment      serum_used      phenotype               commercial_assay   exception_populations   exception_uM_concentrations
1.  cisplatin       CEU2,YRI2,CEU3,YRI3,ASW                 0,1,2.5,5,10,20                 IC50            48                      FBS             cell_growth_inhibition  alamarBlue         CHB2,JPT2,CHD           0,0.1,0.5,1,5,10,20,40
2.  carboplatin     CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,CHD,ASW   0,10,20,40,80                   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
3.  capecitabine    CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,2.5,10,20,40                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
4.  daunorubicin    CEU2,YRI2,YRI3                          0,0.0125,0.025,0.05,0.1,0.2,1   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
5.  pemetrexed      CEU2,YRI2,CEU3,YRI3                     0,0.02,0.1,0.5                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
6.  arac            CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,1,5,10,40                     AUC             72                      FBS             cell_growth_inhibition  alamarBlue
7.  etoposide       CEU2,YRI2,YRI3                          0,0.02,0.1,0.5,2.5              IC50            72                      FBS             cell_growth_inhibition  alamarBlue
8.  hydroxyurea     CEU2,YRI2                               0,5,10,25,50,100,250,500        IC50            72                      FBS             cell_growth_inhibition  alamarBlue
9.  busulfan        CEU2,YRI2                               0,25,50,100,250,500,1000,2000   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
10. paclitaxel      CEU2,YRI2,ASW                           0,0.00625,0.0125,0.05           AUC             72                      BGS             cell_growth_inhibition  alamarBlue

cd bimbam_files/
ls
#Files containing CEU populations 
  CEU.TGP_and_imputed.rmBAD.20130526.geno.gz 
	CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam
#Move files into home/rachel/LCL_chemotherapy 
	# cp file location and name then to where the file is going 
	
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.geno.gz  /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/master_cytotoxicity_info_130311_plus_igrowth.txt /home/rachel/LCL_chemotherapy

#Create a Relationship Matrix in gemma. Need the genotype file and phenotype files 
	gemma -g gentoype.gz -p phenotype.txt -gk 1 -o output_name 
	#genotype file (need bimbam format): CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	#phenotype file: using master toxicity file 
########DRUG 4 ARAC##################################	
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
          View(pheno)
          CEU <- subset(pheno, pop == "CEU")
          View(CEU)
          pheno_CEU_ARAClog2IC50 <- CEU[, 1:13]
          View(pheno_CEU_ARAClog2IC50)
          write.table(pheno_CEU_ARAClog2IC50, file = "pheno_CEU_ARAClog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_ARAClog2IC50_noIDs <- pheno_CEU_ARAClog2IC50[, 5:13]
         View(pheno_CEU_ARAClog2IC50_noIDs)
         write.table(pheno_CEU_ARAClog2IC50_noIDs, file = "pheno_CEU_ARAClog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 	  
#Run Gemma to calculate estimated realtedness matrix 

cp /home/rachel/pheno_CEU_ARAClog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
#error to open phenotype file 

## Need to order phenotype file to match genotype file in R 
        Fam_IDs <- read.table("/home/rachel/LCL_chemotherapy/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam")
        colnames(Fam) <- c("FID", "IID", "FatID", "MatID", "Sex", "Pheno")
        pheno <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_ARCAlog2I50.txt")
	
#Run with gemma again 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
	##Segmentation fault 
	#pheno has 180 enteries while fam has 178 enteries 
CEU_ordered <- left_join(Fam, CEU by = c("V1" = "FID", "V2" = "IID"))

 write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_ARAClog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_ordered_noIDs <- CEU_ordered[, 10:17]
        write.table(CEU_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_ARAClog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz  -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
##Calculating Relatedness Matrix ... 
##Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix.cXX.txt and CEU_relationship_matrix.log.txt

#Run gemma with maf run gemma with maf
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -maf 0.05 -o CEU_relationship_matrix_maf
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 5219481
##Calculating Relatedness Matrix ... 
##Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix_maf.cXX.txt and CEU_relationship_matrix_maf.log.txt

#Make drug based phenotype files in R 
 master_phenos <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
    CEU_master_phenos <- subset(master_phenos, pop == "CEU")
    CEU_master_phenos_ordered <- left_join(Fam, CEU_master_pheno, by = c("FID" = "FID", "IID" = "IID", "FatID" = "father", "MatID" = "mother", "Sex" = "sex"))
    CEU_ARAC_pheno <- select(CEU_master_phenos_ordered, 1:13, contains("ARAC"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For ARCA use pheno AUC, use rank normalized (Rn) (ARAC_RnAUC)
#In R	
  CEU_ARAC_bestpheno <- select(CEU_ARAC_pheno, 1:12,17, contains("ARCA_RnAUC"))
    write.table(CEU_ARAC_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_ARAC_bestpheno.txt", col.names = T, row.names = F, sep = "/t")
   # Create a file with phenotype only to use in gemma 
    CEU_ARCA_bestpheno_noIDs <- select(CEU_ARCA_bestpheno, contains("ARCA"))
    write.table(CEU_ARAC_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_ARCA_bestpheno_noIDs.txt", col.names = F, row.names = F, sep = "/t")
 #In Gemma (terminal)
    cd LCL_chemotherapy 
    cd output
    cp /home/rachel/LCL_chemotherapy/output CEU_relationship_matrix_maf.cXX.txt /home/rachel/LCL_chemotherapy 
    cd ..
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz -p CEU_ARCA_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ARAC

    #error: segmentation fault 
    # Unzip SNP file with gunzip filename.snp.info.gz
	gunzip CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
   # Unzip Geno file with gunzip filename.geno.gz
   	gunzip CEU.TGP_and_imputed.rmBAD.20130526.geno.gz
	
    #run again
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_ARCA_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ARAC
   #Reading Files ... 
	## number of total individuals = 178
	## number of analyzed individuals = 178
	## number of covariates = 1
	## number of phenotypes = 1
	## number of total SNPs = 6577474
	## number of analyzed SNPs = 6335054
	##Start Eigen-Decomposition...
	##pve estimate =3.271e-06
	##se(pve) =-nan
	##Reading SNPs  ==================================================100.00%
	
CEU_ARAC_bestpheno_2 <- select(CEU_ARAC_pheno, contains("ARAC_RnAUC"))
write.table(CEU_ARAC_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_ARAC_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_ARAC_bestpheno_2_noIDs <- select(CEU_ARAC_bestpheno_2, contains ("ARCA")
write.table(CEU_ARAC_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_ARAC_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_ARCA_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ARAC
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 165
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6310542
Start Eigen-Decomposition...
pve estimate =0.261103
se(pve) =0.178758
Reading SNPs  ==================================================100.00%
	#Got a p-value
################################## 1 ###############################################
#Repeat Process for Cisplatin# 
#DRUG 1 CIS
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
          View(pheno)
          CEU <- subset(pheno, pop == "CEU")
          View(CEU)
          pheno_CEU_CISlog2IC50 <- select(CEU, 1:12,19, contains("CIS_log2IC50"))
          View(pheno_CEU_CISlog2IC50)
          write.table(pheno_CEU_CISlog2IC50, file = "pheno_CEU_CISlog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CISlog2IC50_noIDs <- pheno_CEU_CISlog2IC50[, 5:13]
         View(pheno_CEU_CISlog2IC50_noIDs)
         write.table(pheno_CEU_CISlog2IC50_noIDs, file = "pheno_CEU_CISlog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CISlog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CISlog2IC50.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 

## Need to order phenotype file to match genotype file in R 
        Fam_IDs <- read.table("/home/rachel/LCL_chemotherapy/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam")
        colnames(Fam) <- c("FID", "IID", "FatID", "MatID", "Sex", "Pheno")
        pheno_CIS <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2I50.txt")
	
#Run with gemma again 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
	##Segmentation fault 
	#pheno has 180 enteries while fam has 178 enteries 
	
 write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU__CIS_ordered_noIDs <- select(CEU_ordered, 10:16,23, contains("CIS_log2IC50"))
        write.table(CEU_CIS_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix_maf.cXX.txt and CEU_relationship_matrix_maf.log.txt

#Make drug based phenotype files in R 
    CEU_CIS_pheno <- select(CEU_master_phenos_ordered, 1:12,20, contains("CIS"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For CIS use pheno IC50, use rank normalized (Rn) (CIS_RnIC50)
#In R	
CEU_CIS_bestpheno_2 <- select(CEU_CIS_pheno, contains("CIS_log2IC50"))
write.table(CEU_CIS_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CIS_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_CIS_bestpheno_2_noIDs <- select(CEU_CIS_bestpheno_2, contains ("CIS")
write.table(CEU_CIS_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CIS_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CIS_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CIS
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 166
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6312355
Start Eigen-Decomposition...
pve estimate =0.101753
se(pve) =0.189405
Reading SNPs  ==================================================100.00%
	#Got a p-value

########################### 2 ###################################################
#Repeat Process for Carboplatin# 
#DRUG 2 CARBO
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_CARBOlog2IC50 <- select(CEU, 1:12,17, contains("CARBO_log2IC50"))
          View(pheno_CEU_CARBOlog2IC50)
          write.table(pheno_CEU_CARBOlog2IC50, file = "pheno_CEU_CARBOlog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CARBOlog2IC50_noIDs <- pheno_CEU_CARBOlog2IC50[, 5:13]
         View(pheno_CEU_CARBOlog2IC50_noIDs)
         write.table(pheno_CEU_CARBO2IC50_noIDs, file = "pheno_CEU_CARBO2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CISlog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CISlog2IC50.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info -p pheno_CEU_CARBOlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 
## Need to order phenotype file to match genotype file in R 
        pheno_CARBO <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CARBOlog2I50.txt")
	
write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CARBOlog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU__CARBO_ordered_noIDs <- select(CEU_ordered, 10:16,21, contains("CARBO_log2IC50"))
        write.table(CEU_CARBO_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CARBO2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CARBO2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
    CEU_CARBO_pheno <- select(CEU_master_phenos_ordered, 1:12,18, contains("CARBO"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For CIS use pheno IC50, use rank normalized (Rn) (CIS_RnIC50)
#In R	
  CEU_CARBO_bestpheno <- select(CEU_CARBO_pheno, 1:12, contains("CARBO_RnIC50"))
    write.table(CEU_CARBO_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno.txt", col.names = T, row.names = F, sep = "/t")
  #Create phenotype file only to run with gemma
    CEU_CARBO_bestpheno_noIDs <- select(CEU_CARBO_bestpheno, contains("CARBO_RNIC50"))
    write.table(CEU_CARBO_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno_noIDs.txt", col.names = F, row.names = F, sep = "/t")
    
 cd LCL_chemotherapy 
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CARBO_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CARBO
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Start Eigen-Decomposition...
pve estimate =3.271e-06
se(pve) =-nan
Reading SNPs  ==================================================100.00%

CEU_CARBO_bestpheno_2 <- select(CEU_CARBO_pheno, contains("CARBO_RnIC50"))
write.table(CEU_CARBO_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_CARBO_bestpheno_2_noIDs <- select(CEU_CARBO_bestpheno_2, contains ("CARBO"))
write.table(CEU_CARBO_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CARBO_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CARBO
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 168
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6315985
Start Eigen-Decomposition...
pve estimate =0.212706
se(pve) =0.200632
Reading SNPs  ==================================================100.00%
	#Got a p-value
########################################################### 3 #######################################################
#Repeat Process for Capecitabine# 
#DRUG 2 CAPE
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_CAPElog2AUC <- select(CEU, 1:12,16, contains("CAPE_log2AUC"))
          View(pheno_CEU_CAPElog2AUC)
          write.table(pheno_CEU_CAPElog2AUC, file = "pheno_CEU_CAPElog2AUC.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CAPElog2AUC_noIDs <- pheno_CEU_CAPElog2AUC[, 5:13]
         View(pheno_CEU_CAPElog2AUC_noIDs)
         write.table(pheno_CEU_CAPElog2AUC_noIDs, file = "pheno_CEU_CAPElog2AUC_noIDs.txt", sep = "\t", row.names = F, col.names = F)
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CAPElog2AUC_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CAPElog2AUC.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info -p pheno_CEU_CAPElog2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 
## Need to order phenotype file to match genotype file in R 
        pheno_CAPE <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC.txt")
	
write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_CAPE_ordered_noIDs <- select(CEU_ordered, 10:16,20, contains("CAPE_log2AUC"))
        write.table(pheno_CEU_CAPElog2AUC_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
#try to run again -------->gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CAPElog2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
	#segmentaion fault 


###########################################5###############################################
#Repeat process for Daunorubicin 
# DRUG 4 DAUNO 
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno_CEU_DAUNOlog2IC50 <- select(CEU, 1:12,21, contains("DAUNO_log2IC50"))
          View(pheno_CEU_DAUNOlog2IC50)
          write.table(pheno_CEU_DAUNOlog2IC50, file = "pheno_CEU_DAUNOlog2IC50.txt", sep = "/t")
        ##Without header/IDs created for acutal use 
         pheno_CEU_DAUNOlog2IC50_noIDs <- pheno_CEU_DAUNOlog2IC50[, 5:13]
         View(pheno_CEU_DAUNOlog2IC50_noIDs)
         write.table(pheno_CEU_DAUNOlog2IC50_noIDs, file = "pheno_CEU_DAUNOlog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_DAUNOlog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_DAUNOlog2IC50.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info -p pheno_CEU_DAUNOlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 
 
 ## Need to order phenotype file to match genotype file in R 
        pheno_DAUNO <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_DAUNOlog2IC50.txt")
	
write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_DAUNOlog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_DAUNO_ordered_noIDs <- select(CEU_ordered, 10:16,25, contains("DAUNO_log2IC50"))
        write.table(CEU_DAUNO_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_DAUNOlog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")

cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_DAUNOlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
    CEU_DAUNO_pheno <- select(CEU_master_phenos_ordered, 1:12,22, contains("DAUNO"))
#Run univariate mixed linear GWAS in gemma using GRM
	#For DAUNO use pheno IC50, use rank normalized (Rn) (DAUNO_log2IC50)
	
 CEU_DAUNO_bestpheno_2 <- select(CEU_DAUNO_pheno, contains("DAUNO_log2IC50"))
write.table(CEU_DAUNO_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_DAUNO_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_DAUNO_bestpheno_2_noIDs <- select(CEU_DAUNO_bestpheno_2, contains ("DAUNO"))
write.table(CEU_DAUNO_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_DAUNO_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#In terminal 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_DAUNO_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_DAUNO
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 86
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6263189
Start Eigen-Decomposition...
pve estimate =0.679158
se(pve) =0.200392
Reading SNPs  ==================================================100.00%

###############################################5#################################################
#Repeat Process for Pemetrexed# 
#DRUG 5 PEME
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_PEME_log2AUC <- select(CEU, 1:12,27, contains("PEME_log2AUC"))
          View(pheno_CEU_PEME_log2AUC)
          write.table(pheno_CEU_PEME_log2AUC, file = "pheno_CEU_PEME_log2AUC.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_PEME_log2AUC_noIDs <- pheno_CEU_PEME_log2AUC[, 5:13]
         View(pheno_CEU_PEME_log2AUC_noIDs)
         write.table(pheno_CEU_PEME_log2AUC_noIDs, file = "pheno_CEU_PEME_log2AUC_noIDs.txt", sep = "\t", row.names = F, col.names = F)
 #In terminal 
 cp /home/rachel/pheno_CEU_PEME_log2AUC_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_PEME_log2AUC.txt /home/rachel/LCL_chemotherapy 
## Need to order phenotype file to match genotype file in R 
        pheno_PEME <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_PEME_log2AUC_noIDs.txt")

write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_PEME_log2AUC.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_PEME_ordered_noIDs <- select(CEU_ordered, 10:16,31, contains("PEME_log2AUC"))
        write.table(CEU_PEME_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_PEME_log2AUC_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_PEME_log2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
    CEU_PEME_pheno <- select(CEU_master_phenos_ordered, 1:12,28, contains("PEME"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For PEME use pheno log2AUC, use rank normalized (Rn) (PEME_log2AUC)
#In R	
CEU_PEME_bestpheno_2 <- select(CEU_PEME_pheno, contains("PEME_log2AUC"))
write.table(CEU_PEME_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_PEME_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_PEME_bestpheno_2_noIDs <- select(CEU_PEME_bestpheno_2, contains ("PEME"))
write.table(CEU_PEME_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_PEME_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#In terminal 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_PEME_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_PEME
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 84
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6254701
Start Eigen-Decomposition...
pve estimate =0.453914
se(pve) =0.223791
Reading SNPs  ==================================================100.00%

###############################################7#################################################
#Repeat Process for Etoposide# 
#DRUG 7 ETOP
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_ETOP_log2IC50 <- select(CEU, 1:12,38, contains("ETOP_Rn_IC50"))
          View(pheno_CEU_ETOP_log2IC50)
          write.table(pheno_CEU_ETOP_log2IC50, file = "pheno_CEU_ETOP_log2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_ETOP_log2IC50_noIDs <- pheno_CEU_ETOP_log2IC50[, 5:13]
         View(pheno_CEU_ETOP_log2IC50_noIDs)
         write.table(pheno_CEU_ETOP_log2IC50_noIDs, file = "pheno_CEU_ETOP_log2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
 #In terminal 
 cp /home/rachel/pheno_CEU_ETOP_log2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_ETOP_log2IC50.txt /home/rachel/LCL_chemotherapy 
## Need to order phenotype file to match genotype file in R 
        pheno_ETOP <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_ETOP_log2IC50_noIDs.txt")

write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_ETOP_log2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_ETOP_ordered_noIDs <- select(CEU_ordered, 10:16,42, contains("ETOP_Rn_IC50"))
        write.table(CEU_ETOP_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_ETOP_log2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_ETOP_log2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%


#Make drug based phenotype files in R 
CEU_ETOP_pheno <- select(CEU_master_phenos_ordered, 1:12,39, contains("ETOP"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For ETOP use pheno log2AUC, use rank normalized (Rn) (ETOP_Rn_IC50)
#In R	
CEU_ETOP_bestpheno_2 <- select(CEU_ETOP_pheno, contains("ETOP_Rn_IC50"))
write.table(CEU_ETOP_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_ETOP_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_ETOP_bestpheno_2_noIDs <- select(CEU_ETOP_bestpheno_2, contains ("ETOP"))
write.table(CEU_ETOP_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_ETOP_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#In terminal 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_ETOP_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ETOP
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 84
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6255207
Start Eigen-Decomposition...
pve estimate =0.437099
se(pve) =0.242251
Reading SNPs  ==================================================100.00%

###############################################10#################################################
#Repeat Process for Paclitaxel# 
#DRUG 7 PACL
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_PACL_log2_AUC <- select(CEU, 1:12,26, contains("PACL_log2_AUC"))
          View(pheno_CEU_PACL_log2_AUC)
          write.table(pheno_CEU_PACL_log2_AUC, file = "pheno_CEU_PACL_log2_AUC.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_PACL_log2_AUC_noIDs <- pheno_CEU_PACL_log2_AUC[, 5:13]
         View(pheno_CEU_PACL_log2_AUC_noIDs)
         write.table(pheno_CEU_PACL_log2_AUC_noIDs, file = "pheno_CEU_PACL_log2_AUC_noIDs.txt", sep = "\t", row.names = F, col.names = F)
 #In terminal 
 cp /home/rachel/pheno_CEU_PACL_log2_AUC_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_PACL_log2_AUC.txt /home/rachel/LCL_chemotherapy 
## Need to order phenotype file to match genotype file in R 
        pheno_PACL <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_PACL_log2_AUC_noIDs.txt")

write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_PACL_log2_AUC.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_PACL_ordered_noIDs <- select(CEU_ordered, 10:16,30, contains("PACL_log2_AUC"))
        write.table(CEU_PACL_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_PACL_log2_AUC_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_PACL_log2_AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
START HERE ----> CEU_PACL_pheno <- select(CEU_master_phenos_ordered, 1:12,42, contains("PACL"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For PACL use pheno log2_AUC, use rank normalized (Rn) (PACL_Rn_AUC)
#In R	
CEU_PACL_bestpheno_2 <- select(CEU_PACL_pheno, contains("PACL_Rn_AUC"))
write.table(CEU_PACL_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_PACL_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_PACL_bestpheno_2_noIDs <- select(CEU_PACL_bestpheno_2, contains ("PACL"))
write.table(CEU_PACL_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_PACL_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#In terminal 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_PACL_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_PACL

#############################################3##################################################################################
#Repeat Process for Capecitabine# 
#DRUG 7 CAPE
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_CAPE_log2AUC <- select(CEU, 1:12,16, contains("CAPE_log2AUC"))
          View(pheno_CEU_CAPE_log2AUC)
          write.table(pheno_CEU_CAPE_log2AUC, file = "pheno_CEU_CAPE_log2AUC.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CAPE_log2AUC_noIDs <- pheno_CEU_CAPE_log2AUC[, 5:13]
         View(pheno_CEU_CAPE_log2AUC_noIDs)
         write.table(pheno_CEU_CAPE_log2AUC_noIDs, file = "pheno_CEU_CAPE_log2AUC_noIDs.txt", sep = "\t", row.names = F, col.names = F)
 #In terminal 
cp /home/rachel/pheno_CEU_CAPE_log2AUC_noIDs.txt /home/rachel/LCL_chemotherapy 
cp /home/rachel/pheno_CEU_CAPE_log2AUC.txt /home/rachel/LCL_chemotherapy 
## Need to order phenotype file to match genotype file in R 
        pheno_CAPE <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CAPE_log2AUC_noIDs.txt")

write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPE_log2AUC.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_CAPE_ordered_noIDs <- select(CEU_ordered, 10:16,20, contains("CAPE_log2AUC"))
        write.table(CEU_CAPE_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPE_log2AUC_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CAPE_log2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
CEU_CAPE_pheno <- select(CEU_master_phenos_ordered, 1:12,32, contains("CAPE"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For CAPE use pheno AUC, use rank normalized (Rn) (CAPE_RnAUC)
#In R	
CEU_CAPE_bestpheno_2 <- select(CEU_CAPE_pheno, contains("CAPE_RnAUC"))
write.table(CEU_CAPE_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CAPE_bestpheno_2.txt", col.names = T, row.names = F, sep = "/t")
CEU_CAPE_bestpheno_2_noIDs <- select(CEU_CAPE_bestpheno_2, contains ("CAPE"))
write.table(CEU_CAPE_bestpheno_2, "/home/rachel/LCL_chemotherapy/CEU_CAPE_bestpheno_2_noIDs.txt", col.names = F, row.names = F, sep = "/t")

#In terminal 
START HERE ----> gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CAPE_bestpheno_2_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CAPE



#Making plots in R
	#Drug 1 Cisplatin
    	#import packages
    	library(data.table)
    	library(dplyr)
    	library(ggplot2)
    	library(qqman)
    #QQ plot 
    GWAS_CIS <- fread("/home/rachel/LCL_chemotherapy/CEU_GWAS_CIS")
    png(filename = "YRI_GWAS_carboplatin.qqplot.png", res=100)
    qq(GWAS_carbo$p_wald)
    dev.off()

    ##Manhattan Plot
    png(filename = "YRI_GWAS_carboplatin.manplot.png", res=100)
    manhattan(GWAS_carbo, chr = "chr", bp = "ps", p = "p_wald")
    dev.off()

    ##repeat with other drugs
