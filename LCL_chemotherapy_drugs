#LC Chemotherapy Drugs 
#Data availble in /home/wheelerlab3/Data/LCL_chemotherapy/
  cd /home/wheelerlab3/Data/LCL_chemotherapy/
  less LCL_drug_assay_info.txt
   Drug            populations                             uM_concentrations               best_phenotype  hrs_drug_treatment      serum_used      phenotype               commercial_assay   exception_populations   exception_uM_concentrations
1.  cisplatin       CEU2,YRI2,CEU3,YRI3,ASW                 0,1,2.5,5,10,20                 IC50            48                      FBS             cell_growth_inhibition  alamarBlue         CHB2,JPT2,CHD           0,0.1,0.5,1,5,10,20,40
2.  carboplatin     CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,CHD,ASW   0,10,20,40,80                   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
3.  capecitabine    CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,2.5,10,20,40                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
4.  daunorubicin    CEU2,YRI2,YRI3                          0,0.0125,0.025,0.05,0.1,0.2,1   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
5.  pemetrexed      CEU2,YRI2,CEU3,YRI3                     0,0.02,0.1,0.5                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
6.  arac            CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,1,5,10,40                     AUC             72                      FBS             cell_growth_inhibition  alamarBlue
7.  etoposide       CEU2,YRI2,YRI3                          0,0.02,0.1,0.5,2.5              IC50            72                      FBS             cell_growth_inhibition  alamarBlue
8.  hydroxyurea     CEU2,YRI2                               0,5,10,25,50,100,250,500        IC50            72                      FBS             cell_growth_inhibition  alamarBlue
9.  busulfan        CEU2,YRI2                               0,25,50,100,250,500,1000,2000   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
10. paclitaxel      CEU2,YRI2,ASW                           0,0.00625,0.0125,0.05           AUC             72                      BGS             cell_growth_inhibition  alamarBlue

cd bimbam_files/
ls
#Files containing CEU populations 
  CEU.TGP_and_imputed.rmBAD.20130526.geno.gz 
	CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam
#Move files into home/rachel/LCL_chemotherapy 
	# cp file location and name then to where the file is going 
	
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.geno.gz  /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/master_cytotoxicity_info_130311_plus_igrowth.txt /home/rachel/LCL_chemotherapy

#Create a Relationship Matrix in gemma. Need the genotype file and phenotype files 
	gemma -g gentoype.gz -p phenotype.txt -gk 1 -o output_name 
	#genotype file (need bimbam format): CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	#phenotype file: using master toxicity file 
	
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
          View(pheno)
          CEU <- subset(pheno, pop == "CEU")
          View(CEU)
          pheno_CEU_ARAClog2IC50 <- CEU[, 1:13]
          View(pheno_CEU_ARAClog2IC50)
          write.table(pheno_CEU_ARAClog2IC50, file = "pheno_CEU_ARAClog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_ARAClog2IC50_noIDs <- pheno_CEU_ARAClog2IC50[, 5:13]
         View(pheno_CEU_ARAClog2IC50_noIDs)
         write.table(pheno_CEU_ARAClog2IC50_noIDs, file = "pheno_CEU_ARAClog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 	  
#Run Gemma to calculate estimated realtedness matrix 

cp /home/rachel/pheno_CEU_ARAClog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
#error to open phenotype file 

## Need to order phenotype file to match genotype file in R 
        fam <- read.table("/home/rachel/LCL_chemotherapy/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam")
        colnames(fam) <- c("FID", "IID", "FatID", "MatID", "Sex", "Pheno")
        pheno <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_ARCAlog2I50.txt")
	
#Run with gemma again 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
	##Segmentation fault 
	#pheno has 180 enteries while fam has 178 enteries 

        pheno_ARAC_ordered <- left_join(fam, pheno, by = c("FID", "IID"))
	--->	#error: error in left_join_impl(x,y, by$x, by$y, suffix$x, suffix$y, check_na_matches(na_matches)): Cna't join on 'FID' X 'FID' becuase of incompatiable types (integer/factor)
	#use as.character(x) to convert to characters 
	pheno_ARAC_ordered <- left_join (fam, pheno, by= c("FID", "IID")
	
        write.table(pheno_ARAC_ordered, "/home/rachel/LCL_chemotherapy/ordered_pheno_CEU_ARAClog2IC50.txt", col.names = T, row.names = T, sep = "/t")
    # Need to create a file with no IDs or col names to use gemma 
        pheno_ordered_ARAC_noIDs <- pheno__ARAC_ordered[, 10:17]
        write.table(pheno_ordered_ARAC_noIds, "/home/rachel/LCL_chemotherapy/ordered_pheno_CEU_ARAClog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
        
