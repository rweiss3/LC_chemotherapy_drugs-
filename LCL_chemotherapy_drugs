#LC Chemotherapy Drugs 
	#FID
	#IID- Independent and identically distributed random variables
#Data availble in /home/wheelerlab3/Data/LCL_chemotherapy/
  cd /home/wheelerlab3/Data/LCL_chemotherapy/
  less LCL_drug_assay_info.txt
   Drug            populations                             uM_concentrations               best_phenotype  hrs_drug_treatment      serum_used      phenotype               commercial_assay   exception_populations   exception_uM_concentrations
1.  cisplatin       CEU2,YRI2,CEU3,YRI3,ASW                 0,1,2.5,5,10,20                 IC50            48                      FBS             cell_growth_inhibition  alamarBlue         CHB2,JPT2,CHD           0,0.1,0.5,1,5,10,20,40
2.  carboplatin     CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,CHD,ASW   0,10,20,40,80                   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
3.  capecitabine    CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,2.5,10,20,40                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
4.  daunorubicin    CEU2,YRI2,YRI3                          0,0.0125,0.025,0.05,0.1,0.2,1   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
5.  pemetrexed      CEU2,YRI2,CEU3,YRI3                     0,0.02,0.1,0.5                  AUC             72                      FBS             cell_growth_inhibition  alamarBlue
6.  arac            CEU2,YRI2,CHB2,JPT2,CEU3,YRI3,ASW       0,1,5,10,40                     AUC             72                      FBS             cell_growth_inhibition  alamarBlue
7.  etoposide       CEU2,YRI2,YRI3                          0,0.02,0.1,0.5,2.5              IC50            72                      FBS             cell_growth_inhibition  alamarBlue
8.  hydroxyurea     CEU2,YRI2                               0,5,10,25,50,100,250,500        IC50            72                      FBS             cell_growth_inhibition  alamarBlue
9.  busulfan        CEU2,YRI2                               0,25,50,100,250,500,1000,2000   IC50            72                      FBS             cell_growth_inhibition  alamarBlue
10. paclitaxel      CEU2,YRI2,ASW                           0,0.00625,0.0125,0.05           AUC             72                      BGS             cell_growth_inhibition  alamarBlue

cd bimbam_files/
ls
#Files containing CEU populations 
  CEU.TGP_and_imputed.rmBAD.20130526.geno.gz 
	CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam
#Move files into home/rachel/LCL_chemotherapy 
	# cp file location and name then to where the file is going 
	
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.geno.gz  /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/bimbam_files/CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz /home/rachel/LCL_chemotherapy
cp /home/wheelerlab3/Data/LCL_chemotherapy/master_cytotoxicity_info_130311_plus_igrowth.txt /home/rachel/LCL_chemotherapy

#Create a Relationship Matrix in gemma. Need the genotype file and phenotype files 
	gemma -g gentoype.gz -p phenotype.txt -gk 1 -o output_name 
	#genotype file (need bimbam format): CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
	#phenotype file: using master toxicity file 
########DRUG 4 ARAC##################################	
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
          View(pheno)
          CEU <- subset(pheno, pop == "CEU")
          View(CEU)
          pheno_CEU_ARAClog2IC50 <- CEU[, 1:13]
          View(pheno_CEU_ARAClog2IC50)
          write.table(pheno_CEU_ARAClog2IC50, file = "pheno_CEU_ARAClog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_ARAClog2IC50_noIDs <- pheno_CEU_ARAClog2IC50[, 5:13]
         View(pheno_CEU_ARAClog2IC50_noIDs)
         write.table(pheno_CEU_ARAClog2IC50_noIDs, file = "pheno_CEU_ARAClog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 	  
#Run Gemma to calculate estimated realtedness matrix 

cp /home/rachel/pheno_CEU_ARAClog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
#error to open phenotype file 

## Need to order phenotype file to match genotype file in R 
        Fam_IDs <- read.table("/home/rachel/LCL_chemotherapy/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam")
        colnames(Fam) <- c("FID", "IID", "FatID", "MatID", "Sex", "Pheno")
        pheno <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_ARCAlog2I50.txt")
	
#Run with gemma again 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
	##Segmentation fault 
	#pheno has 180 enteries while fam has 178 enteries 
CEU_ordered <- left_join(Fam, CEU by = c("V1" = "FID", "V2" = "IID"))

 write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_ARAClog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_ordered_noIDs <- CEU_ordered[, 10:17]
        write.table(CEU_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_ARAClog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz  -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
##Calculating Relatedness Matrix ... 
##Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix.cXX.txt and CEU_relationship_matrix.log.txt

#Run gemma with maf run gemma with maf
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz -p pheno_CEU_ARAClog2IC50_noIDs.txt -gk 1 -maf 0.05 -o CEU_relationship_matrix_maf
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 5219481
##Calculating Relatedness Matrix ... 
##Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix_maf.cXX.txt and CEU_relationship_matrix_maf.log.txt

#Make drug based phenotype files in R 
 master_phenos <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
    CEU_master_phenos <- subset(master_phenos, pop == "CEU")
    CEU_master_phenos_ordered <- left_join(Fam, CEU_master_pheno, by = c("FID" = "FID", "IID" = "IID", "FatID" = "father", "MatID" = "mother", "Sex" = "sex"))
    CEU_ARAC_pheno <- select(CEU_master_phenos_ordered, 1:13, contains("ARAC"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For ARCA use pheno AUC, use rank normalized (Rn) (ARAC_RnAUC)
#In R	
  CEU_ARAC_bestpheno <- select(CEU_ARAC_pheno, 1:12,17, contains("ARCA_RnAUC"))
    write.table(CEU_ARAC_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_ARAC_bestpheno.txt", col.names = T, row.names = F, sep = "/t")
   # Create a file with phenotype only to use in gemma 
    CEU_ARCA_bestpheno_noIDs <- select(CEU_ARCA_bestpheno, contains("ARCA"))
    write.table(CEU_ARAC_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_ARCA_bestpheno_noIDs.txt", col.names = F, row.names = F, sep = "/t")
 #In Gemma (terminal)
    cd LCL_chemotherapy 
    cd output
    cp /home/rachel/LCL_chemotherapy/output CEU_relationship_matrix_maf.cXX.txt /home/rachel/LCL_chemotherapy 
    cd ..
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno.gz -p CEU_ARCA_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ARAC

    #error: segmentation fault 
    # Unzip SNP file with gunzip filename.snp.info.gz
	gunzip CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz 
   # Unzip Geno file with gunzip filename.geno.gz
   	gunzip CEU.TGP_and_imputed.rmBAD.20130526.geno.gz
	
    #run again
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_ARCA_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_ARAC
   #Reading Files ... 
	## number of total individuals = 178
	## number of analyzed individuals = 178
	## number of covariates = 1
	## number of phenotypes = 1
	## number of total SNPs = 6577474
	## number of analyzed SNPs = 6335054
	##Start Eigen-Decomposition...
	##pve estimate =3.271e-06
	##se(pve) =-nan
	##Reading SNPs  ==================================================100.00%

################################## 1 ###############################################
#Repeat Process for Cisplatin# 
#DRUG 1 CIS
#Create Phenotype File In R	
	#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference 
          pheno <- read.table ("/home/rachel/LCL_chemotherapy/master_cyctotoxicity_info_130311_plus_igrowth.txt", header = T)
          View(pheno)
          CEU <- subset(pheno, pop == "CEU")
          View(CEU)
          pheno_CEU_CISlog2IC50 <- select(CEU, 1:12,19, contains("CIS_log2IC50"))
          View(pheno_CEU_CISlog2IC50)
          write.table(pheno_CEU_CISlog2IC50, file = "pheno_CEU_CISlog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CISlog2IC50_noIDs <- pheno_CEU_CISlog2IC50[, 5:13]
         View(pheno_CEU_CISlog2IC50_noIDs)
         write.table(pheno_CEU_CISlog2IC50_noIDs, file = "pheno_CEU_CISlog2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
	 
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CISlog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CISlog2IC50.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 

## Need to order phenotype file to match genotype file in R 
        Fam_IDs <- read.table("/home/rachel/LCL_chemotherapy/CEU.chr10.TGP_and_imputed.20130416.exclude_BAD_SNPs.fam")
        colnames(Fam) <- c("FID", "IID", "FatID", "MatID", "Sex", "Pheno")
        pheno_CIS <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2I50.txt")
	
#Run with gemma again 
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info.gz -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
	##Segmentation fault 
	#pheno has 180 enteries while fam has 178 enteries 
	
 write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU__CIS_ordered_noIDs <- select(CEU_ordered, 10:16,23, contains("CIS_log2IC50"))
        write.table(CEU_CIS_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CISlog2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CISlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

cd output
ls
	#created CEU_relationship_matrix_maf.cXX.txt and CEU_relationship_matrix_maf.log.txt

#Make drug based phenotype files in R 
    CEU_CIS_pheno <- select(CEU_master_phenos_ordered, 1:12,20, contains("CIS"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For CIS use pheno IC50, use rank normalized (Rn) (CIS_RnIC50)
#In R	
  CEU_CIS_bestpheno <- select(CEU_CIS_pheno, 1:12, contains("CIS_RnIC50"))
    write.table(CEU_CIS_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CIS_bestpheno.txt", col.names = T, row.names = F, sep = "/t")
  #Create phenotype file only to run with gemma
    CEU_CIS_bestpheno_noIDs <- select(CEU_CIS_bestpheno, contains("CIS"))
    write.table(CEU_CIS_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CIS_bestpheno_noIDs.txt", col.names = F, row.names = F, sep = "/t")
  
 #In Gemma (terminal)
  cd LCL_chemotherapy 
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CIS_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CIS
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Start Eigen-Decomposition...
pve estimate =3.271e-06
se(pve) =-nan
Reading SNPs  ==================================================100.00%

########################### 2 ###################################################
#Repeat Process for Carboplatin# 
#DRUG 2 CARBO
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_CARBOlog2IC50 <- select(CEU, 1:12,17, contains("CARBO_log2IC50"))
          View(pheno_CEU_CARBOlog2IC50)
          write.table(pheno_CEU_CARBOlog2IC50, file = "pheno_CEU_CARBOlog2IC50.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CARBOlog2IC50_noIDs <- pheno_CEU_CARBOlog2IC50[, 5:13]
         View(pheno_CEU_CARBOlog2IC50_noIDs)
         write.table(pheno_CEU_CARBO2IC50_noIDs, file = "pheno_CEU_CARBO2IC50_noIDs.txt", sep = "\t", row.names = F, col.names = F)
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CISlog2IC50_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CISlog2IC50.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info -p pheno_CEU_CARBOlog2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 
## Need to order phenotype file to match genotype file in R 
        pheno_CARBO <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CARBOlog2I50.txt")
	
write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CARBOlog2IC50.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU__CARBO_ordered_noIDs <- select(CEU_ordered, 10:16,21, contains("CARBO_log2IC50"))
        write.table(CEU_CARBO_ordered_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CARBO2IC50_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CARBO2IC50_noIDs.txt -gk 1 -o CEU_relationship_matrix
Reading Files ... 
## number of total individuals = 178
## number of analyzed individuals = 178
## number of covariates = 1
## number of phenotypes = 1
## number of total SNPs = 6577474
## number of analyzed SNPs = 6335054
Calculating Relatedness Matrix ... 
Reading SNPs  ==================================================100.00%

#Make drug based phenotype files in R 
    CEU_CARBO_pheno <- select(CEU_master_phenos_ordered, 1:12,18, contains("CARBO"))

#Run univariate mixed linear GWAS in gemma using GRM
	#For CIS use pheno IC50, use rank normalized (Rn) (CIS_RnIC50)
#In R	
  CEU_CARBO_bestpheno <- select(CEU_CARBO_pheno, 1:12, contains("CARBO_RnIC50"))
    write.table(CEU_CARBO_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno.txt", col.names = T, row.names = F, sep = "/t")
  #Create phenotype file only to run with gemma
    CEU_CARBO_bestpheno_noIDs <- select(CEU_CARBO_bestpheno, contains("CARBO_RNIC50"))
    write.table(CEU_CARBO_bestpheno, "/home/rachel/LCL_chemotherapy/CEU_CARBO_bestpheno_noIDs.txt", col.names = F, row.names = F, sep = "/t")
    
 cd LCL_chemotherapy 
    gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno -p CEU_CARBO_bestpheno_noIDs.txt -a CEU.TGP_and_imputed.rmBAD.20130526.snp.info -k CEU_relationship_matrix_maf.cXX.txt -lmm 4 -o CEU_GWAS_CARBO
    
    
    
    
    
    
    
########################################################### 3 #######################################################
#Repeat Process for Capecitabine# 
#DRUG 2 CAPE
#Create Phenotype File In R	
#To Make Phenotype File in R, using CEU with only one phenotype 
    	#no header, no IDs for .txt for gemma
    	##With header/IDs created to use as reference
          pheno_CEU_CAPElog2AUC <- select(CEU, 1:12,16, contains("CAPE_log2AUC"))
          View(pheno_CEU_CAPElog2AUC)
          write.table(pheno_CEU_CAPElog2AUC, file = "pheno_CEU_CAPElog2AUC.txt", sep = "\t")
	  
        ##Without header/IDs created for acutal use 
         pheno_CEU_CAPElog2AUC_noIDs <- pheno_CEU_CAPElog2AUC[, 5:13]
         View(pheno_CEU_CAPElog2AUC_noIDs)
         write.table(pheno_CEU_CAPElog2AUC_noIDs, file = "pheno_CEU_CAPElog2AUC_noIDs.txt", sep = "\t", row.names = F, col.names = F)
#Run Gemma to calculate estimated realtedness matrix 
 cp /home/rachel/pheno_CEU_CAPE_log2AUC_noIDs.txt /home/rachel/LCL_chemotherapy 
 cp /home/rachel/pheno_CEU_CAPElog2AUC.txt /home/rachel/LCL_chemotherapy 
 gemma -g CEU.TGP_and_imputed.rmBAD.20130526.snp.info -p pheno_CEU_CAPElog2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
 #segmentation fault 
## Need to order phenotype file to match genotype file in R 
        pheno_CAPE <- read.table("/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC.txt")
	
write.table(CEU_ordered, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC.txt", col.names = T, row.names = T, sep = "/t")
  #Need to craete a file with no IDS or col names to use with gemma 
        CEU_CAPE_ordered_noIDs <- select(CEU_ordered, 10:16,20, contains("CAPE_log2AUC"))
        write.table(pheno_CEU_CAPElog2AUC_noIDs, "/home/rachel/LCL_chemotherapy/pheno_CEU_CAPElog2AUC_noIDs.txt", col.names = F, row.names = F, sep = "/t")
	
#Run gemma in terminal 
cd LCL_chemotherapy
-------->gemma -g CEU.TGP_and_imputed.rmBAD.20130526.geno  -p pheno_CEU_CAPE_log2AUC_noIDs.txt -gk 1 -o CEU_relationship_matrix
	#segmentaion fault 

